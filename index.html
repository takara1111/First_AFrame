<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Hello, WebVR! • A-Frame</title>
    <meta name="description" content="Hello, WebVR! • A-Frame" />
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  </head>
  <body>
    <a-scene background="color: #FAFAFA">
      <a-box
        position="-1 0.5 -3"
        rotation="0 45 0"
        color="#4CC3D9"
        shadow
      ></a-box>
      <a-sphere
        position="0 1.25 -5"
        radius="1.25"
        color="#EF2D5E"
        shadow
      ></a-sphere>
      <a-cylinder
        position="1 0.75 -3"
        radius="0.5"
        height="1.5"
        color="#FFC65D"
        shadow
      ></a-cylinder>
      <a-plane
        position="0 0 -4"
        rotation="-90 0 0"
        width="4"
        height="4"
        color="#7BC8A4"
        shadow
      ></a-plane>
      <a-entity
        :laser-controls="{ hand, model: false }"
        raycaster="objects: .click, [block]; direction: 0 -0.8660254037844387 -0.4999999999999998; origin: 0 0 -0.04"
        gun
      >
        <a-entity
          obj-model="obj: #gun-obj; mtl: #gun-mtl"
          position="0 -0.03 -0.07"
          rotation="60 180 0"
          scale="0.3 0.3 0.3"
        ></a-entity>
      </a-entity>
      <a-entity camera look-controls position="0 1.6 0">
        <a-text
          id="txt"
          value="test"
          position="0 0 -1"
          scale="0.5 0.5 0.5"
          align="center"
          color="#000000"
        ></a-text>
      </a-entity>
    </a-scene>
    <!--下記を追加-->
    <script>
      const ctlL = document.getElementById("ctlL");
      const ctlR = document.getElementById("ctlR");
      const txt = document.getElementById("txt");

      //Trigger Pressed
      ctlL.addEventListener("triggerdown", function(event) {
        txt.setAttribute("value", "Left trigger down");
      });
      ctlR.addEventListener("triggerdown", function(event) {
        txt.setAttribute("value", "Right trigger down");
      });
      //Trigger Released
      ctlL.addEventListener("triggerup", function(event) {
        txt.setAttribute("value", "Left trigger up");
      });
      ctlR.addEventListener("triggerup", function(event) {
        txt.setAttribute("value", "Right trigger up");
      });

      import { registerComponent } from "aframe";

      const bulletDistance = 20.0;

      registerComponent("gun", {
        init() {
          this.el.addEventListener("triggerdown", (e: TriggerDownEvent) => {
            this.generateBullet();
          });
        },
        generateBullet() {
          // レーザー生成
        }
      });

      const bullet = document.createElement("a-cylinder");
      bullet.setAttribute("bullet", {});
      bullet.setAttribute("position", {
        x: 0,
        y: -0.2 - bulletDistance,
        z: -0.04
      });
      bullet.setAttribute("scale", { x: 1, y: bulletDistance * 2, z: 1 });
      bullet.setAttribute("rotation", { x: 0, y: 0, z: 0 });
      bullet.setAttribute("radius", 0.03);
      bullet.setAttribute("material", "color: white; opacity: 0.5");
      group.appendChild(bullet);

      document.querySelector("a-scene").appendChild(group);
    </script>
    <!--追加はここまで-->
  </body>
</html>
